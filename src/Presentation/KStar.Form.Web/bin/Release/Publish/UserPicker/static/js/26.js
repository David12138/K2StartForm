webpackJsonp([26],{685:function(t,e,a){"use strict";var i={name:"page",props:{pageIndex:{type:Number,default:1,required:!0},pageSize:{type:Number,default:1,required:!0},total:{type:Number,default:0,required:!0},pageSizesList:{type:Array,required:!0}},data:function(){return{}},methods:{handleSizeChange:function(t){this.$emit("handleSizeChange",t)},handleCurrentChange:function(t){this.$emit("handleCurrentChange",t)},firstPage:function(){this.pageIndex=1},tailPage:function(){this.pageIndex=this.$refs.page.internalPageCount}}},n={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"page"},[a("el-pagination",{ref:"page",attrs:{background:"","current-page":t.pageIndex,"page-sizes":t.pageSizesList,"page-size":t.pageSize,"prev-text":t.$t("UserPicker.HomePage"),"next-text":t.$t("UserPicker.TailPage"),layout:"total, prev, pager, next, sizes",total:t.total},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange,"prev-click":t.firstPage,"next-click":t.tailPage}})],1)},staticRenderFns:[]};var s=a(47)(i,n,!1,function(t){a(687)},"data-v-18a42a56",null).exports;e.a=s},687:function(t,e){},712:function(t,e,a){"use strict";var i=a(160),n=a.n(i),s=a(67),o=(a(1),a(359),{name:"",props:{rowData:{type:Object}},data:function(){return{activeName:"flowStep",templateStep:[],logData:[],flowChartdata:[],processtemplatename:"",activeIndex:0,loading:!1}},mounted:function(){this.burialPointEvent("列表-流程图图标"),this.burialPointEvent("列表-流程步骤"),this.getFlowStep(),this.closeProcessImg()},methods:{burialPointEvent:function(t){s.a.burialPoint(this.$route.name+"-"+t)},labelHead:function(t,e){var a=e.column;e.index;return t("span",{attrs:{title:a.label}},[null!=a.label&&a.label.length>12?a.label.substr(0,12)+"...":a.label])},close:function(){this.$emit("hideComponent")},closeProcessImg:function(){var t=this;document.getElementsByClassName("pc-candidates")[0].addEventListener("click",function(e){"pc-candidates"===e.target.classList[0]&&t.$emit("hideComponent")})},handleClick:function(t,e){switch(t.name){case"flowStep":break;case"flowChart":this.flowChartdata&&0!=this.flowChartdata.length||this.getFlowChart();break;case"flowLog":this.logData&&0!=this.logData.length||this.getFlowLog()}},getFlowStep:function(){var t=this,e=t.rowData.procInstID,a=(t.rowData.procInstNo,{procinstid:e});t.loading=!0,t.$axios.post("/api/vkProcess/step",a).then(function(e){var a=e.data;t.processtemplatename=a.processtemplatename;var i=!0,s=!1,o=void 0;try{for(var r,l=n()(a.result);!(i=(r=l.next()).done);i=!0){var c=r.value,d=c.finishdate,u=c.startdate,p="";t.CheckDateTime(u)&&t.CheckDateTime(d)&&(p=t.returnatetime(u,d));var m={activityname:c.activityname,stepData:[{username:c.username,finishdate:d,useTime:p}]};t.templateStep.push(m)}}catch(t){s=!0,o=t}finally{try{!i&&l.return&&l.return()}finally{if(s)throw o}}t.loading=!1}).catch(function(e){t.loading=!1,t.$message.error("获取流程步骤失败！"+e)})},returnatetime:function(t,e){t=t.replace(new RegExp(/-/gm),"/"),e=e.replace(new RegExp(/-/gm),"/");var a=new Date(t),i=new Date(e).getTime()-a.getTime(),n=i%864e5,s=n%36e5,o=s%6e4;return Math.floor(i/864e5)+"天 "+Math.floor(n/36e5)+"小时 "+Math.floor(s/6e4)+" 分钟"+Math.round(o/1e3)+" 秒"},CheckDateTime:function(t){var e=t.match(/^(\d+)-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})$/);if(null==e)return!1;e[2]=e[2]-1;var a=new Date(e[1],e[2],e[3],e[4],e[5],e[6]);return a.getFullYear()==e[1]&&(a.getMonth()==e[2]&&(a.getDate()==e[3]&&(a.getHours()==e[4]&&(a.getMinutes()==e[5]&&a.getSeconds()==e[6]))))},getFlowLog:function(){var t=this,e={procinstid:this.rowData.procInstID};t.loading=!0,t.$axios.post("/api/vkProcess/log",e).then(function(e){t.logData=e.data.result,t.loading=!1}).catch(function(e){t.loading=!1,t.$message.error("获取流程日志失败！"+e)})},getFlowChart:function(){var t=this,e=this,a=e.rowData.procInstID;e.loading=!0,e.$axios.post("/api/vkProcess/img",{procinstid:a}).then(function(a){var i=a.data.result,n=i.stepObj,s=i.stepName,o=i.activity;e.setStepValue(o,n,s),t.flowChartdata=e.split(o),e.loading=!1}).catch(function(a){e.loading=!1,t.$message.error("获取流程图失败！"+a)})},setStepValue:function(t,e,a){if(!e&&!a){var i=!0,s=!1,o=void 0;try{for(var r,l=n()(t);!(i=(r=l.next()).done);i=!0){r.value.status="finish"}}catch(t){s=!0,o=t}finally{try{!i&&l.return&&l.return()}finally{if(s)throw o}}}if(e&&a){var c=!0,d=!1,u=void 0;try{for(var p,m=n()(t);!(c=(p=m.next()).done);c=!0){var h=p.value;Number(h.activityorder)<Number(e.activityorder)?(h.activityname+="(已完成)",h.status="finish"):Number(h.activityorder)==Number(e.activityorder)?(h.activityname+="(审批中)",h.status="process"):Number(h.activityorder)>Number(e.activityorder)&&(h.activityname+="(未审批)",h.status="wait")}}catch(t){d=!0,u=t}finally{try{!c&&m.return&&m.return()}finally{if(d)throw u}}this.activeIndex=Number(e.activityorder)}if(!e&&a){var g=!0,f=!1,v=void 0;try{for(var b,w=n()(t);!(g=(b=w.next()).done);g=!0){var y=b.value;y.activityname+="(未审批)",y.status="wait"}}catch(t){f=!0,v=t}finally{try{!g&&w.return&&w.return()}finally{if(f)throw v}}}t.unshift({activityid:"start_",activityname:"开始",status:"finish"})},split:function(t){for(var e=[],a=Math.ceil(t.length/5);a>0;)e.push(t.slice(5*(a-1),5*a)),a--;return e=e.reverse()}}}),r={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"flow_chart"},[a("div",{staticClass:"pc-candidates pc-background"},[a("div",{staticClass:"dialog_content"},[a("div",{staticClass:"top"},[t._v("流程图"),a("span",{staticStyle:{cursor:"pointer","font-size":"30px"},on:{click:t.close}},[t._v("×")])]),t._v(" "),a("div",{staticClass:"initProcess"},[a("el-tabs",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{type:"border-card","element-loading-text":"拼命加载中","element-loading-background":"rgba(255, 255, 255, 0.8)"},on:{"tab-click":t.handleClick},model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[a("el-tab-pane",{attrs:{calss:"steps",name:"flowStep"}},[a("span",{attrs:{slot:"label",name:"step"},slot:"label"},[a("i",{staticClass:"iconfont icon-processsteps"}),t._v(" 流程步骤")]),t._v(" "),a("div",{staticClass:"content"},[a("div",{staticClass:"content-top"},[a("h2",{staticClass:"name"},[t._v("流程模板："),a("span",[t._v(t._s(t.processtemplatename))])])]),t._v(" "),a("div",{staticClass:"scrollDiv"},t._l(t.templateStep,function(e,i){return a("div",{key:i,staticClass:"clearfix"},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.stepData,border:""}},[a("el-table-column",{attrs:{label:(i+1).toString(),align:"center",width:"50"}}),t._v(" "),a("el-table-column",{attrs:{prop:"username",label:e.activityname,align:"center","render-header":t.labelHead,width:"180"}}),t._v(" "),a("el-table-column",{attrs:{prop:"finishdate",label:"填单时间",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{label:"所用时间",align:"center",prop:"useTime"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.useTime))]}}])})],1)],1)}))])]),t._v(" "),a("el-tab-pane",{attrs:{name:"flowChart"}},[a("span",{attrs:{slot:"label"},on:{click:function(e){t.burialPointEvent("列表-流程图-流程图")}},slot:"label"},[a("i",{staticClass:"iconfont icon-flowchart"}),t._v(" 流程图")]),t._v(" "),a("div",[a("el-steps",{attrs:{"align-center":!0}},t._l(t.flowChartdata,function(e,i){return a("div",{key:i,staticClass:"step-linerow"},t._l(e,function(t){return a("el-step",{key:t.activityid,attrs:{status:t.status,title:t.activityname.length>27?t.activityname.substr(0,25)+"...":t.activityname}})}))}))],1)]),t._v(" "),a("el-tab-pane",{attrs:{name:"flowLog"}},[a("span",{attrs:{slot:"label"},on:{click:function(e){t.burialPointEvent("列表-流程图-操作日志")}},slot:"label"},[a("i",{staticClass:"iconfont icon-operationlog"}),t._v(" 操作日志")]),t._v(" "),[a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.logData,border:""}},[a("el-table-column",{attrs:{label:" ",type:"index","header-align":"center",width:"50"}}),t._v(" "),a("el-table-column",{attrs:{prop:"username",label:"操作人","header-align":"center","win-width":"160"}}),t._v(" "),a("el-table-column",{attrs:{prop:"timestamp",label:"时间","header-align":"center","win-width":"140"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("moment")(e.row.timestamp,"YYYY-MM-DD HH:mm:ss")))]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"message","header-align":"center",width:"135",label:"操作结果"}})],1)]],2)],1)],1)])])])},staticRenderFns:[]};var l=a(47)(o,r,!1,function(t){a(713)},"data-v-46b706d8",null);e.a=l.exports},713:function(t,e){},735:function(t,e){},776:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a(68),n=a.n(i),s=a(82),o=(a(1),a(67)),r=a(712),l=(a(359),{name:"draftProcess",components:{page:a(685).a,flowchart_dialog:r.a},mounted:function(){var t=this;o.a.burialPoint("流程草稿-进入流程草稿页面"),t.getList(),window.onmessage=function(e){"refreshNewSystem"===e.data.key&&t.getList()}},data:function(){return{model:{whereParams:{}},procInstIDs:[],comp:{},loading:!1,company:"",pageIndex:1,total:10,pageSize:10,pageSizesList:[10,20],draftList:[],showMess:!1,rowData:{},applyReason:"",multipleSelections:[],exportData:[],orderBy:"StartDate DESC",imgLoading:!1}},methods:{sortChange:function(t){o.a.burialPoint("流程草稿-列表-"+t.column.label+"排序"),this.orderBy=t.prop+" "+t.order.replace("ending",""),this.getList()},renderIcon:function(t,e){e.column;return t("i",{class:"iconfont icon-process"})},openDailog:function(t){this.comp.component=t,this.showdialog=!0,o.a.showDailog_mask()},hideComponent:function(){this.showdialog=!1,o.a.hiddenDailog_mask()},deleteList:function(){this.multipleSelections=this.multipleSelection,""==this.multipleSelection||void 0==this.multipleSelection?this.$message.warning("至少选中一条信息"):this.showMess=!0},correctmess:function(){var t=this,e=this;e.formIds=[];for(var a=0;a<e.multipleSelections.length;a++)e.formIds.push(e.multipleSelections[a].FormId);e.$axios.post("Portal/WorkFlow/DeleteDraft",e.formIds).then(function(a){200==a.data.code?(e.showMess=!1,e.$message({type:"success",message:"删除流程成功!"}),e.$refs.multipleTable.clearSelection(),e.getList()):(e.showMess=!1,e.$message.warning(t.FormId+"删除流程失败!"),e.$refs.multipleTable.clearSelection())}).catch(function(t){e.$message.error("审批失败!ERROR MESSAGE:"+t.response.data.message)})},cancelmess:function(){this.showMess=!1,this.$refs.multipleTable.clearSelection()},search:function(){this.pageIndex=1,this.getList()},getList:function(){var t=this;t.imgLoading=!1;var e={pageSize:this.pageSize,pageIndex:this.pageIndex,orderBy:this.orderBy};t.$axios({url:"/Portal/WorkFlow/GetMyDrafts",method:"post",data:e}).then(function(e){200===e.data.code?(t.draftList=e.data.data.item,t.total=e.data.data.total):t.$message.error("请求失败！")}).catch(function(e){t.imgLoading=!1,t.$message.error("审批失败!ERROR MESSAGE:"+e.response.data.message)})},rowClick:function(t,e,a){a.hasOwnProperty("label")&&""===a.label&&(this.rowData=t,this.openDailog("flowchart_dialog"))},handleSizeChange:function(t){o.a.burialPoint("流程草稿-列表-每页显示条数按钮");var e=""+t;this.pageIndex=1,this.pageSize=parseInt(e),localStorage.draftPageSize=t,this.getList()},handleCurrentChange:function(t){o.a.burialPoint("流程草稿-列表-页码按钮"),this.pageIndex=t,this.getList()},tableHeaderClassName:function(t){t.row,t.rowIndex;return"table-head-th"},handleSelectionChange:function(t){this.multipleSelection=t},folioBlank:function(t){window.open(t.Url,"_blank")}},computed:n()({bodyHeight:function(){return document.documentElement.clientHeight}},Object(s.b)(["count","isSafari","bodyHeight"]))}),c={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.imgLoading,expression:"imgLoading"}],staticClass:"draftProcess todoProcess loadingtext",attrs:{"element-loading-text":"加载中...","element-loading-background":"rgba(255, 255, 255, 0.8)"}},[a("el-container",[a("el-header",[a("div",{staticClass:"top-header"},[a("span",{staticClass:"top-breadCrumb"},[t._v("流程草稿")]),t._v(" "),a("div",{staticClass:"searchCom"})])]),t._v(" "),a("el-main",[a("div",{staticClass:"mainContaint"},[t.showMess?a("el-dialog",{staticClass:"message-dialog",attrs:{visible:t.showMess,id:"delProcess",title:"申请删除草稿","close-on-click-modal":!1,width:"30%"},on:{"update:visible":function(e){t.showMess=e}}},[a("span",{staticClass:"dialog-bodys"},[t._v("您确认需要删除所选草稿吗？")]),t._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary",icon:"el-icon-circle-check-outline",size:"mini"},on:{click:t.correctmess}},[t._v("确 定")]),t._v(" "),a("el-button",{attrs:{icon:"el-icon-circle-close-outline",size:"mini"},on:{click:t.cancelmess}},[t._v("取 消")])],1)]):t._e(),t._v(" "),a("div",{staticClass:"draftProcess-main"},[a("el-row",{staticClass:"listButton",attrs:{type:"flex",justify:"end"}},[a("el-button",{staticClass:"upload",attrs:{round:"",type:"primary",icon:"el-icon-delete",size:"mini"},on:{click:t.deleteList}},[t._v("删除草稿\n          ")])],1),t._v(" "),a("div",{staticClass:"list",class:{table_safari:t.isSafari}},[a("el-table",{ref:"multipleTable",staticStyle:{width:"100%","font-size":"14px"},attrs:{height:t.bodyHeight-253,data:t.draftList,border:"","header-row-class-name":t.tableHeaderClassName,size:"mini"},on:{"sort-change":t.sortChange,"selection-change":t.handleSelectionChange,"row-click":t.rowClick}},[a("el-table-column",{attrs:{type:"selection"}}),t._v(" "),a("el-table-column",{attrs:{prop:"ProcessName",align:"center",label:"流程名称","min-width":"80px"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{attrs:{title:e.row.ProcessName}},[t._v(t._s(e.row.ProcessName))])]}}])}),t._v(" "),a("el-table-column",{staticClass:"table-folio",attrs:{prop:"FormSubject",label:"流程主题",align:"center","min-width":"140px"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticClass:"table-popover folio",on:{click:function(a){t.folioBlank(e.row)}}},[t._v(t._s(e.row.FormSubject))]),t._v(" "),a("el-tooltip",{attrs:{placement:"right",disabled:!e.row.Summary,color:"rgb(166, 176, 185)",effect:"light"}},[a("div",{attrs:{slot:"content"},slot:"content"},[a("div",{staticClass:"toolTipContent"},[a("div",[t._v(t._s(e.row.Summary))])])])])]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"SaveDate",width:"150px",label:"保存时间",sortable:"custom"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("moment")(e.row.SubmitDate,"YYYY-MM-DD HH:mm")))]}}])}),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:!t.imgLoading,expression:"!imgLoading"}],attrs:{slot:"empty"},slot:"empty"},[a("p",{style:{marginTop:"23px"}},[t._v("暂无数据")])]),t._v(" "),a("div",{attrs:{slot:"append"},slot:"append"},[t.draftList.length>0?a("page",{attrs:{pageIndex:t.pageIndex,total:t.total,pageSize:t.pageSize,pageSizesList:t.pageSizesList},on:{handleSizeChange:t.handleSizeChange,handleCurrentChange:t.handleCurrentChange}}):t._e()],1)],1)],1)],1)],1)])],1)],1)},staticRenderFns:[]};var d=a(47)(l,c,!1,function(t){a(735)},"data-v-50bf0f96",null);e.default=d.exports}});