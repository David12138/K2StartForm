webpackJsonp([15],{"4VBW":function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=s("BO1k"),i=s.n(a),o=s("bOdI"),r=s.n(o),l=s("ve2v"),n=s("Lxn6"),c=s("+vjY"),h={name:"opinionReports",data:function(){var e;return e={isShow:!0,showdialog:!1,showList:!1,fullHeight:document.documentElement.clientHeight,arrt:"收起",icon:"el-icon-arrow-down",total:0,comp:{},hintwring:"",hintwringShow:!1,pageIndex:1,orgStates:[]},r()(e,"total",0),r()(e,"queryName",""),r()(e,"multiplelimit",1),r()(e,"loading",!1),r()(e,"pageSize",10),r()(e,"pageSizesList",[10,20,50,100]),r()(e,"childDataUrl",{url:"",selectedPerson:[],chooseProject:{}}),r()(e,"model",{selectForm:{userID:""},userName:[]}),r()(e,"filterEmptyComment",0),r()(e,"orderBy",""),r()(e,"fa",!1),r()(e,"exportTotal",[]),r()(e,"oneCheck",!0),r()(e,"tableData",[]),r()(e,"imgLoading",!1),e},methods:{emptyselect:function(){this.childDataUrl.selectedPerson=[],this.model.userName=[]},getUsers:function(e){var t=this,s=this;s.orgStates=[],s.$axios.post("/api/getUser",{name:e,deptId:"",isWork:"1"}).then(function(e){for(var a=0;a<e.data.result.length;a++)s.orgStates.push({value:e.data.result[a].displayName,userId:e.data.result[a].adAccount,orgFullPath:e.data.result[a].orgNameFullPath,vankeId:e.data.result[a].vankeId});t.loading=!1}).catch(function(e){s.$message.error("查询列表数据失败!ERROR MESSAGE:"+e)})},querySearchUser:function(e){if(this.queryName=e,this.orgStates=[],0==this.model.userName.length){this.hintwring="",this.hintwringShow=!1;var t=this;if(this.loading=!0,this.isSeach)return;this.isSeach=!0,setTimeout(function(){t.isSeach=!1,t.validationInput(t.queryName)},2e3)}else""==e.trim()?(this.hintwringShow=!1,this.hintwring=""):(this.hintwringShow=!0,this.hintwring="注意：此处账号选择只能单选！")},personChange:function(e){this.$set(this.$refs.userId,"query",""),this.childDataUrl.selectedPerson[0]=e},removeUser:function(e){if(e.userId){for(var t=0;t<this.childDataUrl.selectedPerson.length&&e.userId!=this.childDataUrl.selectedPerson[t].userId;t++);this.childDataUrl.selectedPerson.splice(t,1)}else{for(t=0;t<this.childDataUrl.selectedPerson.length&&e!=this.childDataUrl.selectedPerson[t].value;t++);this.childDataUrl.selectedPerson.splice(t,1)}},validationInput:function(e){if(""==e||0==e.length)return this.loading=!1,null;e==this.$refs.userId.query?this.getUsers(e):this.orgStates=[]},visibleChange:function(e){this.orgStates=[],e||(this.hintwringShow=!1,this.hintwring="")},handleSizeChange:function(e){var t=""+e;this.pageIndex=1,this.pageSize=parseInt(t),localStorage.myInitPageSize=e,this.select()},handleCurrentChange:function(e){this.pageIndex=e,this.select()},sortChange:function(e){0!==this.model.userName.length&&(this.orderBy=e.prop+" "+e.order.replace("ending",""),this.select())},isChecked:function(e){this.filterEmptyComment=1==e?1:0},exportList:function(){var e=this;if(0!=e.childDataUrl.selectedPerson.length){e.model.selectForm.orderBy=e.orderBy,e.model.selectForm.filterEmptyComment=e.filterEmptyComment,localStorage.todoPageSize&&(e.pageSize=Number(localStorage.todoPageSize));var t="";e.model.selectForm.userID="";var s=!0,a=!1,o=void 0;try{for(var r,l=i()(e.childDataUrl.selectedPerson);!(s=(r=l.next()).done);s=!0){t+="VANKE\\"+r.value.userId+";"}}catch(e){a=!0,o=e}finally{try{!s&&l.return&&l.return()}finally{if(a)throw o}}t&&(e.model.selectForm.userID=t.substring(0,t.length-1)),c.a.startLoading({lock:!0,text:"数据量过大，正在拼命加载中...",background:"rgba(255, 255, 255, 0.9)",target:document.querySelector(".loadingtext")}),e.$axios.post("/api/exportExcelForTable",{tableName:"动态-动态-岗位/人-审批意见的统计",params:e.model.selectForm},{responseType:"blob"}).then(function(e){var t=e.data;n.a.exportSearchList("动态-动态-岗位/人-审批意见的统计",t),c.a.endLoading()}).catch(function(t){c.a.endLoading(),e.$message.error("导出Excel失败!ERROR MESSAGE:"+t)})}else e.$message.warning("请选择账号！做导出数据条件！")},select:function(){var e=this;this.model.selectForm.orderBy=this.orderBy,this.model.selectForm.filterEmptyComment=this.filterEmptyComment,localStorage.todoPageSize&&(this.pageSize=Number(localStorage.todoPageSize));var t="";this.model.selectForm.userID="";var s=!0,a=!1,o=void 0;try{for(var r,l=i()(this.childDataUrl.selectedPerson);!(s=(r=l.next()).done);s=!0){t+="VANKE\\"+r.value.userId+";"}}catch(e){a=!0,o=e}finally{try{!s&&l.return&&l.return()}finally{if(a)throw o}}t&&(this.model.selectForm.userID=t.substring(0,t.length-1)),this.imgLoading=!0,this.model.selectForm.pageIndex=this.pageIndex-1,this.model.selectForm.pageSize=this.pageSize,this.$axios.post("/api/ApprovalOpinions/page",this.model.selectForm).then(function(t){e.tableData=t.data.approvalOpinionsList,e.total=t.data.total,e.imgLoading=!1}).catch(function(t){e.$message.error("查询列表数据失败!ERROR MESSAGE:"+t),e.imgLoading=!1}),this.model.selectForm={}},showMsgfromchild:function(e){if(e.type&&"project"==e.type)if(this.oneCheck){var t=e.last.lastNode;this.model.companys_t=t,this.model.companys=t,this.model.companys.length>15&&(this.model.companys=this.model.companys.substr(0,20)+"..."),this.model.selectForm.departmentID=e.item.orgID,this.model.selectForm.companyCode=e.last.lastId.toString()}else e.items;else if(e.type&&"process"==e.type)this.processFormName=e.text,this.model.selectForm.processID=e.processID;else if(e.type&&"originator"==e.type){this.childDataUrl.selectedPerson=[],this.model.userName=[];var s=!0,a=!1,o=void 0;try{for(var r,l=i()(e.peoArr);!(s=(r=l.next()).done);s=!0){for(var n=r.value,c=n.userId,h=n.vankeId,d=!1,m=0;m<this.childDataUrl.selectedPerson.length;m++)this.childDataUrl.selectedPerson[m].userId===c&&(d=!0);d||(this.childDataUrl.selectedPerson.push({userId:c,value:n.name,vankeId:h}),this.model.userName.push(n.name))}}catch(e){a=!0,o=e}finally{try{!s&&l.return&&l.return()}finally{if(a)throw o}}}this.hideComponent()},inquire:function(){this.pageIndex=1,0==this.model.userName.length?this.$message.warning("请选择账号!"):this.select()},refresh:function(){var e=this;this.orderBy="",this.filterEmptyComment=0,this.fa=!1,this.$nextTick(function(){e.model.selectForm.userID="",e.model.userName=[],e.childDataUrl.selectedPerson=[]})},showToggle:function(){this.showList=!this.showList,this.isShow=!this.isShow,this.isShow?(this.arrt="收起",this.icon="el-icon-arrow-up"):(this.arrt="展开",this.icon="el-icon-arrow-down")},sureSubmit:function(e){},openDialog:function(e,t){this.comp.component=e,this.showdialog=!0,n.a.showDailog_mask(),"originator_dailog"==e?(this.oneCheck=!0,this.childDataUrl.getTree="getTree",this.childDataUrl.companytree="companytree/page"):"project_dialog"==e&&(this.childDataUrl.getTree="getTree",this.childDataUrl.companytree="companytree/page")},hideComponent:function(){this.showdialog=!1,n.a.hiddenDailog_mask()}},mounted:function(){},watch:{fullHeight:function(){return document.documentElement.clientHeight}},components:{page:s("T//Y").a,originator_dailog:l.a}},d={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"opinionReports staticReports"},[s("el-container",[s("el-header",[s("div",{directives:[{name:"loading",rawName:"v-loading",value:e.imgLoading,expression:"imgLoading"}],staticClass:"loadingtext staticReports minWidth",attrs:{"element-loading-text":"加载中...","element-loading-background":"rgba(255, 255, 255, 0.8)"}},[s("div",{staticClass:"taticReports-content"},[s("el-row",{staticClass:"staticReports-header",attrs:{type:"flex",justify:"space-between"}},[s("el-col",{staticClass:"titleMT",attrs:{span:17}},[s("span",{staticClass:"mz",on:{click:function(t){e.$router.back(-1)}}},[e._v("流程报表")]),s("i",{class:e.icon})]),e._v(" "),s("el-col",{staticClass:"titleBtn clearfix",attrs:{span:6}},[s("el-button",{attrs:{round:"",type:"primary",size:"mini"},on:{click:e.refresh}},[e._v("重置")]),e._v(" "),s("el-button",{attrs:{round:"",type:"primary",size:"mini"},on:{click:e.inquire}},[e._v("搜索")])],1)],1),e._v(" "),s("br"),e._v(" "),s("div",{staticClass:"statement reportCondition"},[s("span",{staticClass:"fz16"},[e._v("动态-动态-岗位/人-审批意见的统计")]),e._v(" "),s("el-row",{staticClass:"staticReports-middle lh35 staticReportsMiddle"},[s("el-col",{staticClass:"processSelect",attrs:{sm:4,md:1}},[s("span",[e._v("账号选择")])]),e._v(" "),s("el-col",{staticClass:"classSelectMR  process-inputbox",attrs:{span:7}},[s("i",{staticClass:"iconfont icon-member",on:{click:function(t){e.openDialog("originator_dailog")}}}),e._v(" "),s("el-select",{ref:"userId",attrs:{filterable:"",remote:"","reserve-keyword":"",clearable:"","popper-class":"orgstates","remote-method":e.querySearchUser,"value-key":"userId",placeholder:"",loading:e.loading},on:{change:e.personChange,"visible-change":e.visibleChange,"remove-tag":e.removeUser,clear:e.emptyselect},model:{value:e.model.userName[0],callback:function(t){e.$set(e.model.userName,0,t)},expression:"model.userName[0]"}},e._l(e.orgStates,function(t,a){return s("el-option",{key:a,attrs:{label:t.value,value:t}},[s("div",{staticClass:"userheight",staticStyle:{"font-weight":"600"}},[e._v(e._s(t.value)+"("+e._s(t.userId)+")")]),e._v(" "),s("div",{staticClass:"fullpathsize"},[e._v(e._s(t.orgFullPath))])])}))],1),e._v(" "),s("el-col",{attrs:{span:5}},[s("i",{class:[e.hintwringShow?"el-icon-warning":""]}),s("span",[e._v(e._s(e.hintwring)+" ")])]),e._v(" "),s("el-col",{attrs:{span:2}},[s("el-checkbox",{on:{change:e.isChecked},model:{value:e.fa,callback:function(t){e.fa=t},expression:"fa"}},[e._v("过滤掉为“空”的意见")])],1)],1),e._v(" "),s("el-row",[s("el-col",{staticClass:"buttonWrap buttonWrapTA",attrs:{span:4}},[s("el-button",{staticClass:"upload",attrs:{round:"",type:"primary",icon:"iconfont icon-export",size:"mini"},on:{click:function(t){e.exportList()}}},[e._v("导出\n              ")])],1)],1)],1),e._v(" "),s("div",{staticClass:"statement"},[s("el-table",{ref:"singleTable",attrs:{data:e.tableData,"highlight-current-row":"",border:"",height:e.showList?e.fullHeight-405:e.fullHeight-280},on:{"sort-change":e.sortChange}},[s("el-table-column",{attrs:{property:"procInstNO",label:"流程实例编号",width:"150",sortable:"custom"}}),e._v(" "),s("el-table-column",{attrs:{property:"processName",label:"流程名称",align:"left",sortable:"custom"}}),e._v(" "),s("el-table-column",{attrs:{property:"topic",width:"125",label:"流程主题",sortable:"custom"}}),e._v(" "),s("el-table-column",{attrs:{property:"activityName",label:"环节名称",width:"150",sortable:"custom"}}),e._v(" "),s("el-table-column",{attrs:{property:"approval",label:"审批结果",width:"100",sortable:"custom"}}),e._v(" "),s("el-table-column",{attrs:{property:"comment",label:"审批意见",width:"120",sortable:"custom"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("div",{domProps:{innerHTML:e._s(t.row.comment)}})]}}])}),e._v(" "),s("el-table-column",{attrs:{property:"approvalDate",label:"审批时间",width:"150",sortable:"custom"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e._f("moment")(t.row.approvalDate,"YYYY-MM-DD")))]}}])}),e._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:!e.imgLoading,expression:"!imgLoading"}],attrs:{slot:"empty"},slot:"empty"},[s("p",{style:{marginTop:"23px"}},[e._v("暂无数据")])]),e._v(" "),s("div",{attrs:{slot:"append"},slot:"append"},[s("page",{attrs:{pageIndex:e.pageIndex,total:e.total,pageSize:e.pageSize,pageSizesList:e.pageSizesList},on:{handleSizeChange:e.handleSizeChange,handleCurrentChange:e.handleCurrentChange}})],1)],1)],1)],1)]),e._v(" "),e.showdialog?s(e.comp.component,{tag:"component",attrs:{oneCheck:e.oneCheck,childDataUrl:e.childDataUrl,queryName:e.queryName},on:{hideComponent:e.hideComponent,sureSubmit:e.showMsgfromchild}}):e._e()],1)],1)],1)},staticRenderFns:[]};var m=s("VU/8")(h,d,!1,function(e){s("Ah/S")},"data-v-a21cf206",null);t.default=m.exports},"Ah/S":function(e,t){}});
//# sourceMappingURL=15.da08323da11c0ebbf10f.js.map